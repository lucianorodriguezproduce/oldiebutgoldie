rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Branding & Config - Lectura pública, escritura Admin
    match /settings/{document=**} {
      allow read: if true;
      allow write: if request.auth != null; 
    }

    // Telemetry - Creación libre, borrado Admin
    match /interactions/{document=**} {
      allow create, read: if true;
      allow delete: if request.auth != null;
    }
    
    // User data - Privacidad absoluta del dueño
    match /users/{userId}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Editorial - Lectura pública, gestión Admin
    match /editorial/{document=**} {
      allow read: if true;
      allow create, update, delete: if request.auth != null;
    }

    // Subscribers - Suscripción libre, gestión Admin
    match /subscribers/{document=**} {
      allow create: if true;
      allow read, delete: if request.auth != null;
    }

    // Leads - Solo personal autenticado
    match /leads/{document=**} {
      allow read, write: if request.auth != null;
    }

    // Orders - Pedidos públicos, gestión Admin
    match /orders/{document=**} {
      allow read, create: if true;
      allow update, delete: if request.auth != null;
    }

    // Notifications - Solo personal autenticado
    match /notifications/{document=**} {
      allow read, write, delete: if request.auth != null;
    }

    // Inventory - El Búnker: Lectura pública, ingreso y gestión Admin
    match /inventory/{document=**} {
      allow read: if true;
      allow create, update, delete: if request.auth != null;
    }

    // Trades - Negociaciones: Solo personal autenticado
    match /trades/{document=**} {
      allow read, write: if request.auth != null;
    }

    // Analytics - Registro de búsquedas sin resultados
    match /missed_searches/{document=**} {
      allow create: if true;
      allow read: if request.auth != null;
    }
  }
}
